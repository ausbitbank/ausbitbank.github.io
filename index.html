<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8" />
<meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="robots" content="index, follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="style.css" rel="stylesheet">
<script type="text/javascript">
function loadScript(url, callback){
    var script = document.createElement("script")
    script.type = "text/javascript";
    if (script.readyState){  //IE
        script.onreadystatechange = function(){
            if (script.readyState == "loaded" ||
                    script.readyState == "complete"){
                script.onreadystatechange = null;
                callback();
            }
        };
    } else {  //Others
        script.onload = function(){
            callback();
        };
    }
    script.src = url;
    document.getElementsByTagName("head")[0].appendChild(script);
}
loadScript("https://cdn.steemjs.com/lib/latest/steem.min.js", function() {
    loadScript("https://cdn.jsdelivr.net/remarkable/1.7.1/remarkable.min.js", function() {
        var steemusername = 'ausbitbank';
        var showresteems = false;
        var redirect = sessionStorage.redirect;
        delete sessionStorage.redirect;
        var md = new Remarkable({
            html: true,
            breaks: true,
            linkify: true,
            typographer: true
        });
        var yturl= /(?:<a href\=\":?)?(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?([\w\-]{10,12})(?:&feature=related)?(?:[\w\-]{0}:?)?(?:">:?)?(?:\<\/a\>:?)?/g;
        var ytplayer= '\n<iframe width="640" height="360" src="http://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>\n';

        var c = document.getElementById("content");
        var t = document.getElementById("header");
        if (redirect && redirect != location.href) {
            history.replaceState(null, null, redirect);
            var link = redirect.split('/');
            if (link[3].startsWith('@')) { var postauthor=link[3].replace("@",""); ;var permlink=link[4]; } else { var postauthor=steemusername;var permlink=link[3]; }
            steem.api.getContent(postauthor, permlink, function(err, result) {
                document.title = result['title'];
                var postcontent = md.render(result['body'].replace(yturl, ytplayer)) + '<hr><span class="footer" style="text-align:center;"><a href="/" >Return to home page</a></span>';
                t.innerHTML = '<h1>' + result['title'] + '</h1><br />Posted by ' + postauthor + ' on ' + result['last_update'] + ' in ' + result['category']+'<br /><iframe src="https://steemconnect.com/embed/vote?author='+postauthor+'&amp;permlink='+permlink+'" allowtransparency="true" scrolling="no" class="scvote" width="50" height="20" frameborder="0"></iframe>';
                c.innerHTML = postcontent;
            })
        } else {
            steem.api.getState('/@' + steemusername, function(err, result) {
                var json = JSON.parse(result['accounts'][steemusername]['json_metadata']);
                var profile = json['profile'];
                t.style.backgroundImage = "url('"+profile['cover_image']+"')";
                t.innerHTML = '<img src="'+profile['profile_image']+'" id="profilepicture"><br /><div class="profile"><h1>'+profile['name']+'</h1></div><div class="clearfix"></div><div id="headerinfo"><span class="about">'+profile['about']+'</span></div>';
                document.title = 'Recent posts by '+profile['name'];
                for (var i = 0; i < result['accounts'][steemusername]['blog'].length; i += 1) {
                    var handle = result['accounts'][steemusername]['blog'][i].split('/');
                    var postauthor = handle[0];
                    var postpermlink = handle[1];
                    if (postauthor != steemusername && showresteems == false) {} else {
                        c.innerHTML += '<div class="posttitle"><h3><a href="/' + postpermlink + '">' + result['content'][postauthor + '/' + postpermlink]['title'] + '</a></h3>Posted by ' + postauthor + ' on ' + result['content'][postauthor + '/' + postpermlink]['last_update'] + ' in ' + result['content'][postauthor + '/' + postpermlink]['category'] + '<br /><iframe src="https://steemconnect.com/embed/vote?author='+postauthor+'&amp;permlink='+postpermlink+'" allowtransparency="true" scrolling="no" class="scvote" width="50" height="20" frameborder="0"></iframe></div>';
                        var postcontent = '<div id="' + postauthor + '/' + postpermlink + '">';
                        postcontent = md.render(result['content'][postauthor + '/' + postpermlink]['body'].replace(yturl, ytplayer));
                        postcontent += '<hr>';
                        c.innerHTML += postcontent;
                    }
                }
                var postindex = c.innerHTML
            })
        }
    })
});
</script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="column">
        <div id="header"><div class="loader"></div></div>
      </div>
    </div>
    <div class="row">
      <div class="column">
        <div id="content"></div>
      </div>
    </div>
    <div class="row">
      <div class="column">
        <div class="footer">
        </div>
      </div>
    </div>
  </div>
</body></html>
